<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Apology Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      background: #fff0f6;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2rem;
      color: #d63384;
      font-weight: bold;
      z-index: 10;
    }
    #gameOver {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #c92a2a;
      text-align: center;
      display: none;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="score">0</div>
  <div id="gameOver">Game Over<br><small>Tap to Restart</small></div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score');
    const gameOverDisplay = document.getElementById('gameOver');

    let W = window.innerWidth;
    let H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;

    const UNIT = W / 20;
    const GRAVITY = UNIT * 0.04;
    const JUMP = -UNIT * 0.65;
    const SPEED = UNIT * 0.1;

    // Load images
    const walkFrames = [
      Object.assign(new Image(), { src: 'assets/pink_walk_a.png' }),
      Object.assign(new Image(), { src: 'assets/pink_walk_b.png' }),
    ];
    const jumpImg = new Image();
    jumpImg.src = 'assets/pink_jump.png';

    const character = {
      x: UNIT * 2,
      y: 0,
      width: UNIT * 1.5,
      height: UNIT * 1.5,
      vy: 0,
      grounded: false,
      frameIndex: 0
    };

    const groundY = H - UNIT * 3;
    let obstacles = [];
    let score = 0;
    let gameOver = false;
    let frame = 0;

    function resetGame() {
      character.y = groundY - character.height;
      character.vy = 0;
      character.grounded = true;
      obstacles = [];
      score = 0;
      frame = 0;
      gameOver = false;
      gameOverDisplay.style.display = 'none';
    }

    function spawnObstacle() {
      const size = UNIT * 1.5;
      obstacles.push({
        x: W,
        y: groundY - size,
        width: size,
        height: size,
      });
    }

    function update() {
      if (gameOver) return;

      frame++;

      // Gravity
      character.vy += GRAVITY;
      character.y += character.vy;

      // Ground collision
      if (character.y + character.height >= groundY) {
        character.y = groundY - character.height;
        character.vy = 0;
        character.grounded = true;
      } else {
        character.grounded = false;
      }

      // Obstacles
      if (frame % 100 === 0) spawnObstacle();
      obstacles.forEach(ob => ob.x -= SPEED);
      obstacles = obstacles.filter(ob => ob.x + ob.width > 0);

      // Collision detection
      obstacles.forEach(ob => {
        if (
          character.x < ob.x + ob.width &&
          character.x + character.width > ob.x &&
          character.y < ob.y + ob.height &&
          character.y + character.height > ob.y
        ) {
          gameOver = true;
          gameOverDisplay.style.display = 'block';
        }
      });

      score++;
      scoreDisplay.innerText = Math.floor(score / 10);
    }

    function drawCharacter() {
      const img = character.grounded
        ? walkFrames[Math.floor(frame / 10) % 2]
        : jumpImg;
      ctx.drawImage(img, character.x, character.y, character.width, character.height);
    }

    function drawObstacles() {
      ctx.fillStyle = "#ff6b81";
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
      });
    }

    function render() {
      ctx.clearRect(0, 0, W, H);

      // Ground
      ctx.fillStyle = "#ffe3ec";
      ctx.fillRect(0, groundY, W, H - groundY);

      drawCharacter();
      drawObstacles();
    }

    function loop() {
      update();
      render();
      requestAnimationFrame(loop);
    }

    function jump() {
      if (gameOver) {
        resetGame();
        return;
      }
      if (character.grounded) {
        character.vy = JUMP;
        character.grounded = false;
      }
    }

    // Controls
    window.addEventListener('keydown', e => {
      if (e.code === 'Space') jump();
    });
    window.addEventListener('touchstart', jump);

    resetGame();
    loop();
  </script>
</body>
</html>
